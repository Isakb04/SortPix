<ContentPage
    x:Class="SortPix.Pages.MainPage.MainPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml">

    <Grid x:Name="MainGrid" RowDefinitions="Auto, *, *" ColumnDefinitions="2*,8*">
        <!-- Custom Header -->
        <StackLayout Grid.Row="0" Grid.ColumnSpan="2" Orientation="Horizontal" BackgroundColor="#333333" Padding="10">
            <Label Text="SortPix" FontSize="30" TextColor="White" VerticalOptions="Start" Padding="50, 0, 100, 0" />
            <Button Clicked="OnUpButtonClickedBack" Text="Back" HorizontalOptions="Center" />
            <Button Clicked="OnUpButtonClickedRenameSelected" Text="Rename" HorizontalOptions="Center" />
            <Button Clicked="OnbuttonClickedDeleteSelected" Text="Delete" HorizontalOptions="Center" />
            <Button Clicked="OnbuttonClickedCreateFolder" Text="New Folder" HorizontalOptions="Center" />
            <Button Clicked="OnbuttonClickedCreateFile" Text="New File" HorizontalOptions="Center" />
            <Label Text="Location: " FontSize="15" HorizontalOptions="Center" Padding="30, 0, 0, 0"/>
            <Label Text="{Binding CurrentPath}" FontSize="15" HorizontalOptions="Start" TextColor="White" />
            <SearchBar Placeholder="SearchBar" HorizontalOptions="EndAndExpand" 
                       TextChanged="OnSearchBarTextChanged" />
        </StackLayout>

  <Grid Grid.Row="1" Grid.Column="0" Grid.RowSpan="2" BackgroundColor="#333333">
      <CollectionView
          SelectionMode="Single"
          x:Name="SidebarListView">
          <CollectionView.SelectionChanged>OnSidebarItemSelected</CollectionView.SelectionChanged>
          <CollectionView.ItemTemplate>
              <DataTemplate>
                  <Grid Padding="10">
                      <Grid.ColumnDefinitions>
                          <ColumnDefinition Width="Auto" />
                          <ColumnDefinition Width="*" />
                      </Grid.ColumnDefinitions>
                      <Image
                          Grid.Column="0"
                          Source="{Binding IconPath}"
                          HeightRequest="45"
                          WidthRequest="45"
                          VerticalOptions="Center" />
                      <Label
                          Grid.Column="1"
                          HorizontalOptions="StartAndExpand"
                          Text="{Binding Name}"
                          VerticalOptions="Center" />
                  </Grid>
              </DataTemplate>
          </CollectionView.ItemTemplate>
      </CollectionView>
    <StackLayout x:Name="SortButton" HorizontalOptions="FillAndExpand" VerticalOptions="End">
        <Button
            Text="Auto Sort Pictures"
            VerticalOptions="End"
            HorizontalOptions="FillAndExpand"
            Clicked="OnbuttonClickedSort" />
        <StackLayout Orientation="Horizontal" HorizontalOptions="FillAndExpand" VerticalOptions="End">
            <Button
                Text="Dont Tag"
                HorizontalOptions="FillAndExpand"
                Clicked="OnbuttonClickedDontSort" />
            <Button
                Text="Manual Sort"
                HorizontalOptions="FillAndExpand"
                Clicked="OnbuttonClickedManualSort" />
        </StackLayout>
    </StackLayout>
  </Grid>

        <!-- Main Content -->
        <StackLayout Grid.Row="1" Grid.Column="1" Grid.RowSpan="2" BackgroundColor="#797979">
            <ActivityIndicator 
                x:Name="LoadingIndicator" 
                IsRunning="False" 
                IsVisible="False"   
                VerticalOptions="Center"
                HorizontalOptions="Center" />
            <ListView x:Name="FileListView" CachingStrategy="RecycleElement">
                <ListView.ItemTemplate>
                    <DataTemplate>
                        <ViewCell>
                            <Grid ColumnDefinitions="Auto,*" Padding="10">
                                <Image
                                    Aspect="AspectFill"
                                    Grid.Column="0"
                                    HeightRequest="40"
                                    WidthRequest="40"
                                    Source="{Binding IconPath}" />
                                <Label
                                    Grid.Column="1"
                                    Text="{Binding Name}"
                                    VerticalOptions="Center"
                                    HorizontalOptions="StartAndExpand" />
                                <Grid.GestureRecognizers>
                                    <TapGestureRecognizer
                                        NumberOfTapsRequired="1"
                                        Tapped="OnItemSingleTapped" />
                                    <TapGestureRecognizer
                                        NumberOfTapsRequired="2"
                                        Tapped="OnItemDoubleTapped" />
                                </Grid.GestureRecognizers>
                            </Grid>
                        </ViewCell>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
        </StackLayout>
    </Grid>
</ContentPage>
